<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ความคิดเห็นของผู้ใช้ | Scan Check-in</title>
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <style>
        /* feedback-system.css */

/* Root Variables */
:root {
    --primary-blue: #3b82f6;
    --primary-blue-dark: #2563eb;
    --primary-blue-light: #60a5fa;
    --accent-blue: #1e40af;
    --light-blue: #dbeafe;
    --very-light-blue: #f0f7ff;
    
    --white: #ffffff;
    --off-white: #fafafa;
    --light-gray: #f8fafc;
    --gray-100: #f1f5f9;
    --gray-200: #e2e8f0;
    --gray-300: #cbd5e1;
    --gray-400: #94a3b8;
    --gray-500: #64748b;
    --gray-600: #475569;
    --gray-700: #334155;
    --gray-800: #1e293b;
    --gray-900: #0f172a;
    
    --success: #10b981;
    --success-light: #d1fae5;
    --error: #ef4444;
    --error-light: #fee2e2;
    --warning: #f59e0b;
    --warning-light: #fef3c7;
    
    --border-radius: 12px;
    --border-radius-sm: 8px;
    --border-radius-lg: 16px;
    --border-radius-xl: 24px;
    
    --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
    --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
    --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
    
    --transition: all 0.2s ease-in-out;
    --transition-fast: all 0.15s ease-in-out;
    --transition-slow: all 0.3s ease-in-out;
}

/* Reset and Base Styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Inter', 'Segoe UI', 'Roboto', system-ui, -apple-system, sans-serif;
    line-height: 1.6;
    color: var(--gray-800);
    background: linear-gradient(135deg, var(--very-light-blue) 0%, var(--white) 100%);
    min-height: 100vh;
}

/* Navigation Bar */
.navbar {
    background: var(--white);
    border-bottom: 1px solid var(--gray-200);
    position: sticky;
    top: 0;
    z-index: 1000;
    backdrop-filter: blur(10px);
    box-shadow: var(--shadow-sm);
}

.nav-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 70px;
}

.nav-brand {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.nav-logo {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, var(--primary-blue), var(--primary-blue-dark));
    border-radius: var(--border-radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--white);
    font-size: 1.25rem;
}

.nav-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--gray-800);
}

.nav-menu {
    display: flex;
    align-items: center;
    gap: 1.5rem;
}

.nav-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    text-decoration: none;
    color: var(--gray-600);
    border-radius: var(--border-radius-sm);
    transition: var(--transition);
    font-weight: 500;
}

.nav-link:hover {
    color: var(--primary-blue);
    background: var(--light-blue);
}

.user-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.5rem 1rem;
    background: var(--light-blue);
    border-radius: var(--border-radius);
}

.user-name {
    font-weight: 600;
    color: var(--gray-800);
    font-size: 0.875rem;
}

.user-avatar {
    width: 32px;
    height: 32px;
    background: var(--primary-blue);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--white);
    font-size: 1rem;
}

/* Main Container */
.main-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem 1.5rem;
    min-height: calc(100vh - 70px);
}

/* Header Section */
.header-section {
    text-align: center;
    margin-bottom: 3rem;
}

.header-content {
    max-width: 600px;
    margin: 0 auto;
}

.page-title {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    font-size: 2.5rem;
    font-weight: 800;
    color: var(--gray-800);
    margin-bottom: 1rem;
}

.page-title ion-icon {
    font-size: 2.5rem;
    color: var(--primary-blue);
}

.page-subtitle {
    font-size: 1.125rem;
    color: var(--gray-600);
    line-height: 1.7;
}

/* Form Card */
.feedback-form-section {
    margin-bottom: 3rem;
}

.form-card {
    background: var(--white);
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-lg);
    overflow: hidden;
    border: 1px solid var(--gray-200);
}

.form-header {
    background: linear-gradient(135deg, var(--primary-blue), var(--primary-blue-dark));
    color: var(--white);
    padding: 2rem;
    text-align: center;
}

.form-header h2 {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    font-size: 1.5rem;
    font-weight: 700;
}

.form-header ion-icon {
    font-size: 1.5rem;
}

.feedback-form {
    padding: 2rem;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

/* Rating Section */
.rating-section {
    text-align: center;
    padding: 1.5rem;
    background: var(--gray-100);
    border-radius: var(--border-radius);
    border: 2px solid var(--gray-200);
    transition: var(--transition);
}

.rating-section:hover {
    border-color: var(--primary-blue-light);
    background: var(--very-light-blue);
}

.rating-label {
    display: block;
    font-weight: 600;
    color: var(--gray-700);
    margin-bottom: 1rem;
    font-size: 1.125rem;
}

.star-rating {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
}

.star {
    font-size: 2rem;
    cursor: pointer;
    color: var(--gray-300);
    transition: var(--transition-fast);
    padding: 0.25rem;
    border-radius: 50%;
}

.star:hover,
.star.active {
    color: #fbbf24;
    transform: scale(1.1);
}

.rating-text {
    font-size: 1rem;
    font-weight: 600;
    color: var(--gray-600);
    transition: var(--transition);
}

/* Form Groups */
.form-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.form-label {
    font-weight: 600;
    color: var(--gray-700);
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.form-select,
.form-textarea {
    width: 100%;
    padding: 0.875rem 1rem;
    border: 2px solid var(--gray-200);
    border-radius: var(--border-radius);
    font-size: 1rem;
    transition: var(--transition);
    background: var(--white);
    font-family: inherit;
    resize: vertical;
}

.form-select:focus,
.form-textarea:focus {
    outline: none;
    border-color: var(--primary-blue);
    box-shadow: 0 0 0 3px var(--light-blue);
}

.form-textarea {
    min-height: 120px;
    line-height: 1.6;
}

.char-counter {
    text-align: right;
    font-size: 0.875rem;
    color: var(--gray-500);
    margin-top: 0.25rem;
}

/* Checkbox */
.checkbox-container {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    cursor: pointer;
    padding: 1rem;
    background: var(--gray-100);
    border-radius: var(--border-radius);
    transition: var(--transition);
}

.checkbox-container:hover {
    background: var(--light-blue);
}

.checkbox-container input[type="checkbox"] {
    appearance: none;
    width: 20px;
    height: 20px;
    border: 2px solid var(--gray-300);
    border-radius: 4px;
    position: relative;
    cursor: pointer;
    transition: var(--transition);
}

.checkbox-container input[type="checkbox"]:checked {
    background: var(--primary-blue);
    border-color: var(--primary-blue);
}

.checkbox-container input[type="checkbox"]:checked::after {
    content: '';
    position: absolute;
    left: 6px;
    top: 2px;
    width: 6px;
    height: 10px;
    border: solid var(--white);
    border-width: 0 2px 2px 0;
    transform: rotate(45deg);
}

.checkbox-text {
    font-weight: 500;
    color: var(--gray-700);
}

/* Submit Button */
.submit-btn {
    background: linear-gradient(135deg, var(--primary-blue), var(--primary-blue-dark));
    color: var(--white);
    border: none;
    padding: 1rem 2rem;
    border-radius: var(--border-radius);
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    box-shadow: var(--shadow-md);
}

.submit-btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.submit-btn:active {
    transform: translateY(0);
}

/* Statistics Section */
.stats-section {
    margin-bottom: 3rem;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
}

.stat-card {
    background: var(--white);
    padding: 2rem;
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow);
    border: 1px solid var(--gray-200);
    display: flex;
    align-items: center;
    gap: 1.5rem;
    transition: var(--transition);
}

.stat-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
}

.stat-icon {
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, var(--primary-blue), var(--primary-blue-dark));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--white);
    font-size: 1.5rem;
}

.stat-content h3 {
    font-size: 2rem;
    font-weight: 800;
    color: var(--gray-800);
    margin-bottom: 0.25rem;
}

.stat-content p {
    color: var(--gray-600);
    font-weight: 500;
    font-size: 0.875rem;
}

/* Feedback Display Section */
.feedback-display-section {
    margin-bottom: 3rem;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    gap: 1rem;
}

.section-header h2 {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--gray-800);
}

.section-header ion-icon {
    color: var(--primary-blue);
}

.filter-controls {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
}

.filter-select {
    padding: 0.5rem 1rem;
    border: 2px solid var(--gray-200);
    border-radius: var(--border-radius);
    background: var(--white);
    font-size: 0.875rem;
    cursor: pointer;
    transition: var(--transition);
}

.filter-select:focus {
    outline: none;
    border-color: var(--primary-blue);
}

/* Feedback List */
.feedback-list {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.feedback-item {
    background: var(--white);
    border: 1px solid var(--gray-200);
    border-radius: var(--border-radius-lg);
    padding: 1.5rem;
    box-shadow: var(--shadow);
    transition: var(--transition);
}

.feedback-item:hover {
    box-shadow: var(--shadow-md);
    border-color: var(--primary-blue-light);
}

.feedback-item.archived-feedback {
    opacity: 0.8;
    border-left: 4px solid var(--gray-400);
}

.feedback-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
    flex-wrap: wrap;
    gap: 1rem;
}

.feedback-user {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.feedback-user .user-avatar {
    width: 48px;
    height: 48px;
    background: var(--gray-200);
    color: var(--gray-600);
    font-size: 1.25rem;
}

.user-details h4 {
    font-weight: 600;
    color: var(--gray-800);
    margin-bottom: 0.25rem;
}

.user-role {
    font-size: 0.75rem;
    color: var(--gray-500);
    background: var(--gray-100);
    padding: 0.25rem 0.5rem;
    border-radius: var(--border-radius-sm);
    font-weight: 500;
}

.feedback-meta {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 0.5rem;
}

.feedback-rating {
    display: flex;
    gap: 0.25rem;
}

.star-filled {
    color: #fbbf24;
    font-size: 1rem;
}

.star-empty {
    color: var(--gray-300);
    font-size: 1rem;
}

.feedback-time {
    font-size: 0.75rem;
    color: var(--gray-500);
    font-weight: 500;
}

.feedback-content {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.feedback-category {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--primary-blue);
    font-size: 0.875rem;
    font-weight: 500;
}

.feedback-text {
    color: var(--gray-700);
    line-height: 1.7;
    font-size: 1rem;
}

.feedback-actions {
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid var(--gray-200);
    display: flex;
    justify-content: flex-end;
}

.delete-btn {
    background: var(--error);
    color: var(--white);
    border: none;
    padding: 0.5rem 1rem;
    border-radius: var(--border-radius);
    font-size: 0.875rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: var(--transition);
}

.delete-btn:hover {
    background: #dc2626;
    transform: translateY(-1px);
}

/* Load More */
.load-more-container {
    text-align: center;
    margin-top: 2rem;
}

.load-more-btn {
    background: var(--white);
    color: var(--primary-blue);
    border: 2px solid var(--primary-blue);
    padding: 1rem 2rem;
    border-radius: var(--border-radius);
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.load-more-btn:hover {
    background: var(--primary-blue);
    color: var(--white);
}

/* Messages */
.loading-message,
.no-feedback-message {
    text-align: center;
    padding: 3rem 1.5rem;
    color: var(--gray-500);
}

.loading-message ion-icon,
.no-feedback-message ion-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    display: block;
    color: var(--gray-400);
}

.no-feedback-message p {
    font-size: 1.125rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.no-feedback-message small {
    color: var(--gray-400);
}

/* Archived Section */
.archived-section {
    margin-bottom: 3rem;
}

.toggle-btn {
    background: var(--gray-100);
    color: var(--gray-600);
    border: 1px solid var(--gray-300);
    padding: 0.5rem 1rem;
    border-radius: var(--border-radius);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    transition: var(--transition);
}

.toggle-btn:hover {
    background: var(--gray-200);
    color: var(--gray-700);
}

/* Modals */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    backdrop-filter: blur(4px);
    opacity: 0;
    transition: var(--transition-slow);
}

.modal-overlay.active {
    opacity: 1;
}

.modal-content {
    background: var(--white);
    border-radius: var(--border-radius-lg);
    padding: 2rem;
    max-width: 400px;
    width: 90%;
    text-align: center;
    box-shadow: var(--shadow-xl);
    transform: translateY(20px);
    transition: var(--transition-slow);
}

.modal-overlay.active .modal-content {
    transform: translateY(0);
}

.modal-icon {
    margin-bottom: 1rem;
}

.modal-content.success .modal-icon {
    color: var(--success);
    font-size: 4rem;
}

.modal-content.error .modal-icon {
    color: var(--error);
    font-size: 4rem;
}

.modal-content h3 {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    color: var(--gray-800);
}

.modal-content p {
    color: var(--gray-600);
    margin-bottom: 2rem;
    line-height: 1.6;
}

.modal-btn {
    background: var(--primary-blue);
    color: var(--white);
    border: none;
    padding: 0.875rem 2rem;
    border-radius: var(--border-radius);
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
}

.modal-btn:hover {
    background: var(--primary-blue-dark);
}

/* Loading Spinner */
.loading-spinner {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    backdrop-filter: blur(4px);
}

.spinner {
    font-size: 3rem;
    color: var(--primary-blue);
    animation: spin 1s linear infinite;
}

@keyframes spin {
    from {
        transform: rotate(0deg);
    }
    to {
        transform: rotate(360deg);
    }
}

/* Footer */
.footer {
    background: var(--gray-800);
    color: var(--gray-300);
    padding: 2rem 0;
    margin-top: 4rem;
}

.footer-content {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
}

.footer-left p {
    font-size: 0.875rem;
}

.footer-right {
    display: flex;
    gap: 2rem;
}

.footer-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--gray-400);
    text-decoration: none;
    font-size: 0.875rem;
    transition: var(--transition);
}

.footer-link:hover {
    color: var(--primary-blue-light);
}

/* Responsive Design */
@media (max-width: 768px) {
    .nav-container {
        padding: 0 1rem;
        height: 60px;
    }
    
    .nav-title {
        font-size: 1.25rem;
    }
    
    .user-info {
        padding: 0.375rem 0.75rem;
    }
    
    .user-name {
        display: none;
    }
    
    .main-container {
        padding: 1.5rem 1rem;
    }
    
    .page-title {
        font-size: 2rem;
        flex-direction: column;
        text-align: center;
    }
    
    .page-subtitle {
        font-size: 1rem;
    }
    
    .feedback-form {
        padding: 1.5rem;
    }
    
    .form-header {
        padding: 1.5rem;
    }
    
    .form-header h2 {
        font-size: 1.25rem;
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .stat-card {
        padding: 1.5rem;
    }
    
    .section-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }
    
    .section-header h2 {
        font-size: 1.5rem;
    }
    
    .filter-controls {
        width: 100%;
    }
    
    .filter-select {
        flex: 1;
        min-width: 120px;
    }
    
    .feedback-item {
        padding: 1rem;
    }
    
    .feedback-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }
    
    .feedback-meta {
        align-items: flex-start;
        flex-direction: row;
        justify-content: space-between;
        width: 100%;
    }
    
    .star-rating {
        gap: 0.25rem;
    }
    
    .star {
        font-size: 1.75rem;
    }
    
    .modal-content {
        padding: 1.5rem;
        margin: 1rem;
    }
    
    .footer-content {
        flex-direction: column;
        text-align: center;
        gap: 1rem;
    }
    
    .footer-right {
        gap: 1.5rem;
    }
}

@media (max-width: 480px) {
    .nav-brand {
        gap: 0.5rem;
    }
    
    .nav-logo {
        width: 32px;
        height: 32px;
        font-size: 1rem;
    }
    
    .nav-title {
        font-size: 1.125rem;
    }
    
    .page-title {
        font-size: 1.75rem;
    }
    
    .star {
        font-size: 1.5rem;
    }
    
    .feedback-user {
        gap: 0.75rem;
    }
    
    .feedback-user .user-avatar {
        width: 40px;
        height: 40px;
        font-size: 1rem;
    }
    
    .filter-controls {
        flex-direction: column;
    }
    
    .filter-select {
        min-width: auto;
    }
}
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <div class="nav-logo">
                    <ion-icon name="scan-outline"></ion-icon>
                </div>
                <span class="nav-title">Scan Check-in</span>
            </div>
            <div class="nav-menu">
                <a href="./index.html" class="nav-link">
                    <ion-icon name="home-outline"></ion-icon>
                    <span>หน้าหลัก</span>
                </a>
                <div class="user-info" id="userInfo">
                    <span class="user-name" id="userName">กำลังโหลด...</span>
                    <div class="user-avatar" id="userAvatar">
                        <ion-icon name="person-outline"></ion-icon>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <main class="main-container">
        <!-- Header Section -->
        <div class="header-section">
            <div class="header-content">
                <h1 class="page-title">
                    <ion-icon name="chatbubbles-outline"></ion-icon>
                    ความคิดเห็นของผู้ใช้
                </h1>
                <p class="page-subtitle">แบ่งปันประสบการณ์และความคิดเห็นเกี่ยวกับระบบ Scan Check-in</p>
            </div>
        </div>

        <!-- Feedback Form -->
        <div class="feedback-form-section">
            <div class="form-card">
                <div class="form-header">
                    <h2>
                        <ion-icon name="star-outline"></ion-icon>
                        ให้คะแนนและแสดงความคิดเห็น
                    </h2>
                </div>
                
                <form id="feedbackForm" class="feedback-form">
                    <!-- Rating Section -->
                    <div class="rating-section">
                        <label class="rating-label">ให้คะแนนระบบ:</label>
                        <div class="star-rating" id="starRating">
                            <span class="star" data-rating="1">
                                <ion-icon name="star-outline"></ion-icon>
                            </span>
                            <span class="star" data-rating="2">
                                <ion-icon name="star-outline"></ion-icon>
                            </span>
                            <span class="star" data-rating="3">
                                <ion-icon name="star-outline"></ion-icon>
                            </span>
                            <span class="star" data-rating="4">
                                <ion-icon name="star-outline"></ion-icon>
                            </span>
                            <span class="star" data-rating="5">
                                <ion-icon name="star-outline"></ion-icon>
                            </span>
                        </div>
                        <div class="rating-text" id="ratingText">เลือกคะแนน</div>
                    </div>

                    <!-- Category Selection -->
                    <div class="form-group">
                        <label for="category" class="form-label">หมวดหมู่:</label>
                        <select id="category" name="category" class="form-select" required>
                            <option value="">เลือกหมวดหมู่</option>
                            <option value="general">ทั่วไป</option>
                            <option value="ui">ใช้งาน/อินเทอร์เฟส</option>
                            <option value="performance">ประสิทธิภาพ</option>
                            <option value="feature">คุณสมบัติ</option>
                            <option value="bug">ปัญหา/ข้อผิดพลาด</option>
                            <option value="suggestion">ข้อเสนอแนะ</option>
                        </select>
                    </div>

                    <!-- Feedback Text -->
                    <div class="form-group">
                        <label for="feedbackText" class="form-label">ความคิดเห็น:</label>
                        <textarea 
                            id="feedbackText" 
                            name="feedbackText" 
                            class="form-textarea" 
                            placeholder="กรุณาแชร์ความคิดเห็น ประสบการณ์ หรือข้อเสนอแนะของคุณ..."
                            rows="5"
                            maxlength="500"
                            required
                        ></textarea>
                        <div class="char-counter">
                            <span id="charCount">0</span>/500 ตัวอักษร
                        </div>
                    </div>

                    <!-- Anonymous Option -->
                    <div class="form-group">
                        <label class="checkbox-container">
                            <input type="checkbox" id="anonymous" name="anonymous">
                            <span class="checkmark"></span>
                            <span class="checkbox-text">แสดงความคิดเห็นแบบไม่ระบุชื่อ</span>
                        </label>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="submit-btn" id="submitBtn">
                        <ion-icon name="paper-plane-outline"></ion-icon>
                        <span>ส่งความคิดเห็น</span>
                    </button>
                </form>
            </div>
        </div>

        <!-- Statistics Section -->
        <div class="stats-section">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <ion-icon name="chatbubble-ellipses-outline"></ion-icon>
                    </div>
                    <div class="stat-content">
                        <h3 id="totalFeedbacks">0</h3>
                        <p>ความคิดเห็นทั้งหมด</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <ion-icon name="star"></ion-icon>
                    </div>
                    <div class="stat-content">
                        <h3 id="averageRating">0.0</h3>
                        <p>คะแนนเฉลี่ย</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <ion-icon name="time-outline"></ion-icon>
                    </div>
                    <div class="stat-content">
                        <h3 id="recentFeedbacks">0</h3>
                        <p>ความคิดเห็นวันนี้</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Feedback Display Section -->
        <div class="feedback-display-section">
            <div class="section-header">
                <h2>
                    <ion-icon name="list-outline"></ion-icon>
                    ความคิดเห็นล่าสุด
                </h2>
                <div class="filter-controls">
                    <select id="sortFilter" class="filter-select">
                        <option value="newest">ล่าสุด</option>
                        <option value="oldest">เก่าสุด</option>
                        <option value="rating-high">คะแนนสูงสุด</option>
                        <option value="rating-low">คะแนนต่ำสุด</option>
                    </select>
                    <select id="categoryFilter" class="filter-select">
                        <option value="all">ทุกหมวดหมู่</option>
                        <option value="general">ทั่วไป</option>
                        <option value="ui">ใช้งาน/อินเทอร์เฟส</option>
                        <option value="performance">ประสิทธิภาพ</option>
                        <option value="feature">คุณสมบัติ</option>
                        <option value="bug">ปัญหา/ข้อผิดพลาด</option>
                        <option value="suggestion">ข้อเสนอแนะ</option>
                    </select>
                </div>
            </div>

            <!-- Feedback List -->
            <div class="feedback-list" id="feedbackList">
                <div class="loading-message" id="loadingMessage">
                    <ion-icon name="hourglass-outline"></ion-icon>
                    <p>กำลังโหลดความคิดเห็น...</p>
                </div>
                <div class="no-feedback-message" id="noFeedbackMessage" style="display: none;">
                    <ion-icon name="chatbubble-outline"></ion-icon>
                    <p>ยังไม่มีความคิดเห็น</p>
                    <small>เป็นคนแรกที่แสดงความคิดเห็นสิ!</small>
                </div>
            </div>

            <!-- Load More Button -->
            <div class="load-more-container" id="loadMoreContainer" style="display: none;">
                <button class="load-more-btn" id="loadMoreBtn">
                    <ion-icon name="chevron-down-outline"></ion-icon>
                    <span>โหลดเพิ่มเติม</span>
                </button>
            </div>
        </div>

        <!-- Archived Feedback Section (Admin/Teacher only) -->
        <div class="archived-section" id="archivedSection" style="display: none;">
            <div class="section-header">
                <h2>
                    <ion-icon name="archive-outline"></ion-icon>
                    ความคิดเห็นที่เก็บถาวร (24 ชั่วโมงที่แล้ว)
                </h2>
                <button class="toggle-btn" id="toggleArchivedBtn">
                    <ion-icon name="chevron-down-outline"></ion-icon>
                    <span>แสดง/ซ่อน</span>
                </button>
            </div>
            <div class="archived-list" id="archivedList" style="display: none;">
                <!-- Archived feedbacks will be loaded here -->
            </div>
        </div>
    </main>

    <!-- Success Modal -->
    <div class="modal-overlay" id="successModal">
        <div class="modal-content success">
            <div class="modal-icon">
                <ion-icon name="checkmark-circle"></ion-icon>
            </div>
            <h3>ส่งความคิดเห็นสำเร็จ!</h3>
            <p>ขอบคุณสำหรับความคิดเห็นของคุณ</p>
            <button class="modal-btn" onclick="closeModal('successModal')">
                <span>ปิด</span>
            </button>
        </div>
    </div>

    <!-- Error Modal -->
    <div class="modal-overlay" id="errorModal">
        <div class="modal-content error">
            <div class="modal-icon">
                <ion-icon name="alert-circle"></ion-icon>
            </div>
            <h3>เกิดข้อผิดพลาด</h3>
            <p id="errorMessage">กรุณาลองอีกครั้ง</p>
            <button class="modal-btn" onclick="closeModal('errorModal')">
                <span>ปิด</span>
            </button>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner" style="display: none;">
        <div class="spinner">
            <ion-icon name="reload-outline"></ion-icon>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-left">
                <p>&copy; 2024 Scan Check-in System. สงวนลิขสิทธิ์.</p>
            </div>
            <div class="footer-right">
                <a href="#" class="footer-link">
                    <ion-icon name="document-text-outline"></ion-icon>
                    นโยบายความเป็นส่วนตัว
                </a>
                <a href="#" class="footer-link">
                    <ion-icon name="information-circle-outline"></ion-icon>
                    เงื่อนไขการใช้งาน
                </a>
            </div>
        </div>
    </footer>

    <!-- Include JavaScript -->
    <script>
        // feedback-system.js
class FeedbackSystem {
    constructor() {
        this.currentUser = null;
        this.feedbacks = [];
        this.archivedFeedbacks = [];
        this.selectedRating = 0;
        this.currentPage = 1;
        this.feedbacksPerPage = 10;
        
        this.init();
    }

    init() {
        this.checkUserAuthentication();
        this.loadStoredData();
        this.setupEventListeners();
        this.displayFeedbacks();
        this.updateStatistics();
        this.setupAutoArchive();
    }

    // ตรวจสอบการยืนยันตัวตนของผู้ใช้
    checkUserAuthentication() {
        const isLoggedIn = localStorage.getItem('isLoggedIn');
        const userData = localStorage.getItem('userData');
        
        if (isLoggedIn !== 'true' || !userData) {
            alert('กรุณาเข้าสู่ระบบก่อนใช้งาน');
            window.location.href = '/HTML/Profile.html';
            return;
        }
        
        this.currentUser = JSON.parse(userData);
        this.displayUserInfo();
        
        // แสดงส่วนที่เก็บถาวรสำหรับ admin และ teacher
        if (this.currentUser.role === 'admin' || this.currentUser.role === 'teacher') {
            document.getElementById('archivedSection').style.display = 'block';
        }
    }

    // แสดงข้อมูลผู้ใช้
    displayUserInfo() {
        const userName = document.getElementById('userName');
        const userAvatar = document.getElementById('userAvatar');
        
        if (userName && this.currentUser) {
            userName.textContent = `${this.currentUser.firstName} ${this.currentUser.lastName}`;
            
            // เปลี่ยนไอคอนตาม role
            const iconName = this.currentUser.role === 'teacher' ? 'person-circle' : 
                           this.currentUser.role === 'admin' ? 'shield-checkmark' : 'person';
            userAvatar.innerHTML = `<ion-icon name="${iconName}"></ion-icon>`;
        }
    }

    // โหลดข้อมูลจาก localStorage
    loadStoredData() {
        const storedFeedbacks = localStorage.getItem('feedbackData');
        const storedArchived = localStorage.getItem('archivedFeedbackData');
        
        if (storedFeedbacks) {
            this.feedbacks = JSON.parse(storedFeedbacks);
        }
        
        if (storedArchived) {
            this.archivedFeedbacks = JSON.parse(storedArchived);
        }
    }

    // บันทึกข้อมูลลง localStorage
    saveData() {
        localStorage.setItem('feedbackData', JSON.stringify(this.feedbacks));
        localStorage.setItem('archivedFeedbackData', JSON.stringify(this.archivedFeedbacks));
    }

    // ตั้งค่า Event Listeners
    setupEventListeners() {
        // Star Rating
        this.setupStarRating();
        
        // Character Counter
        this.setupCharacterCounter();
        
        // Form Submission
        const feedbackForm = document.getElementById('feedbackForm');
        feedbackForm.addEventListener('submit', (e) => this.handleFormSubmit(e));
        
        // Filter Controls
        document.getElementById('sortFilter').addEventListener('change', () => this.displayFeedbacks());
        document.getElementById('categoryFilter').addEventListener('change', () => this.displayFeedbacks());
        
        // Load More Button
        document.getElementById('loadMoreBtn').addEventListener('click', () => this.loadMoreFeedbacks());
        
        // Archived Section Toggle
        document.getElementById('toggleArchivedBtn').addEventListener('click', () => this.toggleArchivedSection());
        
        // Modal Close Events
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-overlay')) {
                this.closeModal(e.target.id);
            }
        });
    }

    // ตั้งค่าระบบให้คะแนนด้วยดาว
    setupStarRating() {
        const stars = document.querySelectorAll('.star');
        const ratingText = document.getElementById('ratingText');
        const ratingTexts = ['เลือกคะแนน', 'แย่มาก', 'แย่', 'ปานกลาง', 'ดี', 'ดีเยี่ยม'];
        
        stars.forEach(star => {
            star.addEventListener('mouseover', () => {
                const rating = parseInt(star.dataset.rating);
                this.highlightStars(rating);
                ratingText.textContent = ratingTexts[rating];
            });
            
            star.addEventListener('mouseout', () => {
                this.highlightStars(this.selectedRating);
                ratingText.textContent = this.selectedRating > 0 ? ratingTexts[this.selectedRating] : 'เลือกคะแนน';
            });
            
            star.addEventListener('click', () => {
                this.selectedRating = parseInt(star.dataset.rating);
                this.highlightStars(this.selectedRating);
                ratingText.textContent = ratingTexts[this.selectedRating];
            });
        });
    }

    // เน้นดาวตามคะแนน
    highlightStars(rating) {
        const stars = document.querySelectorAll('.star');
        stars.forEach((star, index) => {
            const icon = star.querySelector('ion-icon');
            if (index < rating) {
                icon.name = 'star';
                star.classList.add('active');
            } else {
                icon.name = 'star-outline';
                star.classList.remove('active');
            }
        });
    }

    // ตั้งค่าตัวนับอักษร
    setupCharacterCounter() {
        const textarea = document.getElementById('feedbackText');
        const charCount = document.getElementById('charCount');
        
        textarea.addEventListener('input', () => {
            const count = textarea.value.length;
            charCount.textContent = count;
            
            if (count > 450) {
                charCount.style.color = '#ff6b6b';
            } else if (count > 400) {
                charCount.style.color = '#ffa726';
            } else {
                charCount.style.color = '#666';
            }
        });
    }

    // จัดการการส่งฟอร์ม
    handleFormSubmit(e) {
        e.preventDefault();
        
        if (!this.validateForm()) {
            return;
        }
        
        const formData = new FormData(e.target);
        const feedbackData = {
            id: this.generateId(),
            userId: this.currentUser.username,
            userName: document.getElementById('anonymous').checked ? 'ผู้ใช้ไม่ระบุชื่อ' : `${this.currentUser.firstName} ${this.currentUser.lastName}`,
            userRole: this.currentUser.roleDisplay,
            rating: this.selectedRating,
            category: formData.get('category'),
            text: formData.get('feedbackText'),
            isAnonymous: document.getElementById('anonymous').checked,
            timestamp: new Date().toISOString(),
            createdAt: new Date()
        };
        
        this.showLoading();
        
        // จำลองการส่งข้อมูล
        setTimeout(() => {
            this.feedbacks.unshift(feedbackData);
            this.saveData();
            this.displayFeedbacks();
            this.updateStatistics();
            this.resetForm();
            this.hideLoading();
            this.showModal('successModal');
        }, 1000);
    }

    // ตรวจสอบความถูกต้องของฟอร์ม
    validateForm() {
        if (this.selectedRating === 0) {
            this.showModal('errorModal', 'กรุณาให้คะแนนก่อนส่งความคิดเห็น');
            return false;
        }
        
        const category = document.getElementById('category').value;
        if (!category) {
            this.showModal('errorModal', 'กรุณาเลือกหมวดหมู่');
            return false;
        }
        
        const text = document.getElementById('feedbackText').value.trim();
        if (!text || text.length < 10) {
            this.showModal('errorModal', 'กรุณาเขียนความคิดเห็นอย่างน้อย 10 ตัวอักษร');
            return false;
        }
        
        return true;
    }

    // รีเซ็ตฟอร์ม
    resetForm() {
        document.getElementById('feedbackForm').reset();
        this.selectedRating = 0;
        this.highlightStars(0);
        document.getElementById('ratingText').textContent = 'เลือกคะแนน';
        document.getElementById('charCount').textContent = '0';
        document.getElementById('charCount').style.color = '#666';
    }

    // แสดงความคิดเห็น
    displayFeedbacks() {
        const feedbackList = document.getElementById('feedbackList');
        const loadingMessage = document.getElementById('loadingMessage');
        const noFeedbackMessage = document.getElementById('noFeedbackMessage');
        const loadMoreContainer = document.getElementById('loadMoreContainer');
        
        loadingMessage.style.display = 'none';
        
        let filteredFeedbacks = this.getFilteredFeedbacks();
        
        if (filteredFeedbacks.length === 0) {
            feedbackList.innerHTML = '';
            noFeedbackMessage.style.display = 'block';
            loadMoreContainer.style.display = 'none';
            return;
        }
        
        noFeedbackMessage.style.display = 'none';
        
        const startIndex = 0;
        const endIndex = this.currentPage * this.feedbacksPerPage;
        const feedbacksToShow = filteredFeedbacks.slice(startIndex, endIndex);
        
        feedbackList.innerHTML = '';
        feedbacksToShow.forEach(feedback => {
            feedbackList.appendChild(this.createFeedbackElement(feedback));
        });
        
        // แสดงปุ่ม Load More ถ้ามีข้อมูลเพิ่มเติม
        if (endIndex < filteredFeedbacks.length) {
            loadMoreContainer.style.display = 'block';
        } else {
            loadMoreContainer.style.display = 'none';
        }
    }

    // ได้รับความคิดเห็นที่ผ่านการกรอง
    getFilteredFeedbacks() {
        let filtered = [...this.feedbacks];
        
        // Filter by category
        const categoryFilter = document.getElementById('categoryFilter').value;
        if (categoryFilter !== 'all') {
            filtered = filtered.filter(feedback => feedback.category === categoryFilter);
        }
        
        // Sort
        const sortFilter = document.getElementById('sortFilter').value;
        switch (sortFilter) {
            case 'newest':
                filtered.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                break;
            case 'oldest':
                filtered.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
                break;
            case 'rating-high':
                filtered.sort((a, b) => b.rating - a.rating);
                break;
            case 'rating-low':
                filtered.sort((a, b) => a.rating - b.rating);
                break;
        }
        
        return filtered;
    }

    // สร้าง element สำหรับแสดงความคิดเห็น
    createFeedbackElement(feedback) {
        const feedbackElement = document.createElement('div');
        feedbackElement.className = 'feedback-item';
        
        const categoryNames = {
            'general': 'ทั่วไป',
            'ui': 'ใช้งาน/อินเทอร์เฟส',
            'performance': 'ประสิทธิภาพ',
            'feature': 'คุณสมบัติ',
            'bug': 'ปัญหา/ข้อผิดพลาด',
            'suggestion': 'ข้อเสนอแนะ'
        };
        
        const timeAgo = this.getTimeAgo(new Date(feedback.timestamp));
        const stars = this.generateStarDisplay(feedback.rating);
        
        feedbackElement.innerHTML = `
            <div class="feedback-header">
                <div class="feedback-user">
                    <div class="user-avatar">
                        <ion-icon name="${feedback.isAnonymous ? 'person-outline' : 'person'}"></ion-icon>
                    </div>
                    <div class="user-details">
                        <h4 class="user-name">${feedback.userName}</h4>
                        <span class="user-role">${feedback.isAnonymous ? 'ผู้ใช้' : feedback.userRole}</span>
                    </div>
                </div>
                <div class="feedback-meta">
                    <div class="feedback-rating">
                        ${stars}
                    </div>
                    <span class="feedback-time">${timeAgo}</span>
                </div>
            </div>
            <div class="feedback-content">
                <div class="feedback-category">
                    <ion-icon name="tag-outline"></ion-icon>
                    <span>${categoryNames[feedback.category] || feedback.category}</span>
                </div>
                <p class="feedback-text">${this.escapeHtml(feedback.text)}</p>
            </div>
            ${this.canDeleteFeedback(feedback) ? `
                <div class="feedback-actions">
                    <button class="delete-btn" onclick="feedbackSystem.deleteFeedback('${feedback.id}')">
                        <ion-icon name="trash-outline"></ion-icon>
                        <span>ลบ</span>
                    </button>
                </div>
            ` : ''}
        `;
        
        return feedbackElement;
    }

    // ตรวจสอบว่าสามารถลบความคิดเห็นได้หรือไม่
    canDeleteFeedback(feedback) {
        if (this.currentUser.role === 'admin') return true;
        if (feedback.userId === this.currentUser.username) return true;
        return false;
    }

    // ลบความคิดเห็น
    deleteFeedback(feedbackId) {
        if (confirm('คุณต้องการลบความคิดเห็นนี้หรือไม่?')) {
            this.feedbacks = this.feedbacks.filter(feedback => feedback.id !== feedbackId);
            this.saveData();
            this.displayFeedbacks();
            this.updateStatistics();
        }
    }

    // สร้างการแสดงผลดาว
    generateStarDisplay(rating) {
        let stars = '';
        for (let i = 1; i <= 5; i++) {
            if (i <= rating) {
                stars += '<ion-icon name="star" class="star-filled"></ion-icon>';
            } else {
                stars += '<ion-icon name="star-outline" class="star-empty"></ion-icon>';
            }
        }
        return stars;
    }

    // โหลดความคิดเห็นเพิ่มเติม
    loadMoreFeedbacks() {
        this.currentPage++;
        this.displayFeedbacks();
    }

    // อัปเดตสถิติ
    updateStatistics() {
        const totalFeedbacks = document.getElementById('totalFeedbacks');
        const averageRating = document.getElementById('averageRating');
        const recentFeedbacks = document.getElementById('recentFeedbacks');
        
        // จำนวนความคิดเห็นทั้งหมด
        totalFeedbacks.textContent = this.feedbacks.length;
        
        // คะแนนเฉลี่ย
        if (this.feedbacks.length > 0) {
            const avgRating = this.feedbacks.reduce((sum, feedback) => sum + feedback.rating, 0) / this.feedbacks.length;
            averageRating.textContent = avgRating.toFixed(1);
        } else {
            averageRating.textContent = '0.0';
        }
        
        // ความคิดเห็นวันนี้
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const todayFeedbacks = this.feedbacks.filter(feedback => {
            const feedbackDate = new Date(feedback.timestamp);
            feedbackDate.setHours(0, 0, 0, 0);
            return feedbackDate.getTime() === today.getTime();
        });
        recentFeedbacks.textContent = todayFeedbacks.length;
    }

    // ตั้งค่าระบบเก็บถาวรอัตโนมัติ (ทุก 24 ชั่วโมง)
    setupAutoArchive() {
        // ตรวจสอบและเก็บถาวรทุกครั้งที่โหลดหน้า
        this.archiveOldFeedbacks();
        
        // ตั้งให้ตรวจสอบทุก 1 ชั่วโมง
        setInterval(() => {
            this.archiveOldFeedbacks();
        }, 60 * 60 * 1000); // 1 ชั่วโมง
    }

    // เก็บถาวรความคิดเห็นที่เก่ากว่า 24 ชั่วโมง
    archiveOldFeedbacks() {
        const now = new Date();
        const twentyFourHoursAgo = new Date(now.getTime() - (24 * 60 * 60 * 1000));
        
        const feedbacksToArchive = this.feedbacks.filter(feedback => 
            new Date(feedback.timestamp) < twentyFourHoursAgo
        );
        
        if (feedbacksToArchive.length > 0) {
            // ย้ายไปยังถาวร
            this.archivedFeedbacks = [...this.archivedFeedbacks, ...feedbacksToArchive];
            
            // ลบออกจากรายการหลัก
            this.feedbacks = this.feedbacks.filter(feedback => 
                new Date(feedback.timestamp) >= twentyFourHoursAgo
            );
            
            this.saveData();
            this.displayFeedbacks();
            this.updateStatistics();
            
            console.log(`Archived ${feedbacksToArchive.length} old feedbacks`);
        }
    }

    // แสดง/ซ่อนส่วนถาวร
    toggleArchivedSection() {
        const archivedList = document.getElementById('archivedList');
        const toggleBtn = document.getElementById('toggleArchivedBtn');
        const icon = toggleBtn.querySelector('ion-icon');
        
        if (archivedList.style.display === 'none') {
            archivedList.style.display = 'block';
            icon.name = 'chevron-up-outline';
            this.displayArchivedFeedbacks();
        } else {
            archivedList.style.display = 'none';
            icon.name = 'chevron-down-outline';
        }
    }

    // แสดงความคิดเห็นที่เก็บถาวร
    displayArchivedFeedbacks() {
        const archivedList = document.getElementById('archivedList');
        
        if (this.archivedFeedbacks.length === 0) {
            archivedList.innerHTML = `
                <div class="no-feedback-message">
                    <ion-icon name="archive-outline"></ion-icon>
                    <p>ไม่มีความคิดเห็นที่เก็บถาวร</p>
                </div>
            `;
            return;
        }
        
        // เรียงตามวันที่ล่าสุด
        const sortedArchived = [...this.archivedFeedbacks].sort((a, b) => 
            new Date(b.timestamp) - new Date(a.timestamp)
        );
        
        archivedList.innerHTML = '';
        sortedArchived.forEach(feedback => {
            const feedbackElement = this.createFeedbackElement(feedback);
            feedbackElement.classList.add('archived-feedback');
            archivedList.appendChild(feedbackElement);
        });
    }

    // คำนวณเวลาที่ผ่านมา
    getTimeAgo(date) {
        const now = new Date();
        const diffInSeconds = Math.floor((now - date) / 1000);
        
        if (diffInSeconds < 60) {
            return 'เมื่อสักครู่';
        }
        
        const diffInMinutes = Math.floor(diffInSeconds / 60);
        if (diffInMinutes < 60) {
            return `${diffInMinutes} นาทีที่แล้ว`;
        }
        
        const diffInHours = Math.floor(diffInMinutes / 60);
        if (diffInHours < 24) {
            return `${diffInHours} ชั่วโมงที่แล้ว`;
        }
        
        const diffInDays = Math.floor(diffInHours / 24);
        if (diffInDays < 7) {
            return `${diffInDays} วันที่แล้ว`;
        }
        
        return date.toLocaleDateString('th-TH', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
    }

    // สร้าง ID แบบสุ่ม
    generateId() {
        return 'feedback_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
    }

    // Escape HTML เพื่อป้องกัน XSS
    escapeHtml(text) {
        const map = {
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#039;'
        };
        return text.replace(/[&<>"']/g, (m) => map[m]);
    }

    // แสดง Loading
    showLoading() {
        document.getElementById('loadingSpinner').style.display = 'flex';
    }

    // ซ่อน Loading
    hideLoading() {
        document.getElementById('loadingSpinner').style.display = 'none';
    }

    // แสดง Modal
    showModal(modalId, customMessage = '') {
        const modal = document.getElementById(modalId);
        if (customMessage && modalId === 'errorModal') {
            document.getElementById('errorMessage').textContent = customMessage;
        }
        modal.style.display = 'flex';
        
        // เพิ่ม animation
        setTimeout(() => {
            modal.classList.add('active');
        }, 10);
    }

    // ปิด Modal
    closeModal(modalId) {
        const modal = document.getElementById(modalId);
        modal.classList.remove('active');
        
        setTimeout(() => {
            modal.style.display = 'none';
        }, 300);
    }

    // เคลียร์ข้อมูลทั้งหมด (สำหรับ Admin)
    clearAllData() {
        if (this.currentUser.role !== 'admin') {
            alert('คุณไม่มีสิทธิ์ในการดำเนินการนี้');
            return;
        }
        
        if (confirm('คุณต้องการลบข้อมูลความคิดเห็นทั้งหมดหรือไม่? การดำเนินการนี้ไม่สามารถยกเลิกได้')) {
            this.feedbacks = [];
            this.archivedFeedbacks = [];
            this.saveData();
            this.displayFeedbacks();
            this.updateStatistics();
            alert('ลบข้อมูลทั้งหมดเรียบร้อยแล้ว');
        }
    }

    // ส่งออกข้อมูลเป็น JSON (สำหรับ Admin)
    exportData() {
        if (this.currentUser.role !== 'admin') {
            alert('คุณไม่มีสิทธิ์ในการดำเนินการนี้');
            return;
        }
        
        const exportData = {
            feedbacks: this.feedbacks,
            archivedFeedbacks: this.archivedFeedbacks,
            exportDate: new Date().toISOString(),
            exportedBy: this.currentUser.username
        };
        
        const dataStr = JSON.stringify(exportData, null, 2);
        const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
        
        const exportFileDefaultName = `feedback_data_${new Date().toISOString().split('T')[0]}.json`;
        
        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataUri);
        linkElement.setAttribute('download', exportFileDefaultName);
        linkElement.click();
    }

    // รีเซ็ตหน้าเมื่อเปลี่ยน filter
    resetPagination() {
        this.currentPage = 1;
    }
}

// ปิด Modal เมื่อคลิกนอก Modal
function closeModal(modalId) {
    if (window.feedbackSystem) {
        window.feedbackSystem.closeModal(modalId);
    }
}

// เริ่มต้นระบบเมื่อหน้าเว็บโหลดเสร็จ
document.addEventListener('DOMContentLoaded', function() {
    window.feedbackSystem = new FeedbackSystem();
});

// ป้องกันการปิดหน้าโดยไม่ได้ตั้งใจเมื่อกำลังพิมพ์
window.addEventListener('beforeunload', function(e) {
    const feedbackText = document.getElementById('feedbackText');
    if (feedbackText && feedbackText.value.trim().length > 0) {
        e.preventDefault();
        e.returnValue = 'คุณมีข้อความที่ยังไม่ได้บันทึก คุณต้องการออกจากหน้านี้หรือไม่?';
        return e.returnValue;
    }
});

// ฟังก์ชันสำหรับการจัดการ keyboard shortcuts
document.addEventListener('keydown', function(e) {
    // Ctrl/Cmd + Enter สำหรับส่งฟอร์ม
    if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
        const feedbackForm = document.getElementById('feedbackForm');
        if (feedbackForm && document.activeElement.closest('.feedback-form-section')) {
            e.preventDefault();
            feedbackForm.dispatchEvent(new Event('submit', { cancelable: true }));
        }
    }
    
    // Escape สำหรับปิด Modal
    if (e.key === 'Escape') {
        const activeModals = document.querySelectorAll('.modal-overlay.active');
        activeModals.forEach(modal => {
            window.feedbackSystem.closeModal(modal.id);
        });
    }
});
    </script>
</body>
</html>